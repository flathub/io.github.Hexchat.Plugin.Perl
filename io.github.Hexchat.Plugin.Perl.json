{
  "id": "io.github.Hexchat.Plugin.Perl",
  "branch": "21.08",
  "runtime": "io.github.Hexchat",
  "runtime-version": "stable",
  "sdk": "org.gnome.Sdk//41",
  "build-extension": true,
  "separate-locales": false,
  "appstream-compose": false,
  "build-options": {
    "prefix": "/app/extensions/Perl",
    "prepend-path": "/app/extensions/Perl/bin"
  },
  "modules": [
    {
      "name": "perl",
      "no-autogen": true,
      "config-opts": [
        "-des",
        "-Duseshrplib"
      ],
      "build-options": {
        "cflags": "-fPIC",
        "ldflags": "-fpic"
      },
      "cleanup": [
        "/bin",
        "/man",
        "/lib/perl5/site_perl",
        "*.pod",
        "*.h"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://www.cpan.org/src/5.0/perl-5.34.1.tar.gz",
          "sha256": "357951a491b0ba1ce3611263922feec78ccd581dddc24a446b033e25acf242a1"
        },
        {
          "type": "script",
          "dest-filename": "configure",
          "commands": [
            "exec ./configure.gnu $@"
          ]
        }
      ]
    },
    {
      "name": "hexchat",
      "buildsystem": "meson",
      "config-opts": [
        "--buildtype=release",
        "-Dwith-lua=false",
        "-Dgtk-frontend=false",
        "-Ddbus=disabled"
      ],
      "make-args": [
        "plugins/perl/perl.so"
      ],
      "no-make-install": true,
      "post-install": [
        "install -Dm644 plugins/perl/perl.so ${FLATPAK_DEST}/lib/hexchat/plugins/perl.so",
        "install -Dm644 --target-directory=${FLATPAK_DEST}/share/metainfo data/misc/io.github.Hexchat.Plugin.Perl.metainfo.xml",
        "appstream-compose --basename=io.github.Hexchat.Plugin.Perl --prefix=${FLATPAK_DEST} --origin=flatpak io.github.Hexchat.Plugin.Perl"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://dl.hexchat.net/hexchat/hexchat-2.16.1.tar.xz",
          "sha256": "a7e497da71df419daf9855582d51c723a2611de25d5e97b5efc33fe78da5c4c7"
        },
        {
          "type":"patch",
          "path":"0001-appdata-update-appstream.patch"
        },
        {
          "type": "shell",
          "commands": [
            /* Hack to fix upstream someday */
            "sed -i 's|with-theme-manager|with-appdata|' data/meson.build"
          ]
        }
      ]
    }
  ]
}
